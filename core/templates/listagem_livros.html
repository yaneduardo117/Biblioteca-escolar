{% extends 'base.html' %}

{% block page_title %}Sistema de Biblioteca Escolar{% endblock %}

{% block content %}

<style>
    /* Cards do Topo */
    .card-stat {
        background: white;
        border: none;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .stat-label {
        color: #888;
        font-size: 13px;
        font-weight: 500;
        margin-bottom: 5px;
        text-transform: none;
    }
    .stat-value {
        color: #333;
        font-size: 32px;
        font-weight: 500;
        line-height: 1.2;
    }

    /* Card Principal (Tabela) */
    .main-card {
        background: white;
        border: none;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        margin-top: 20px;
        overflow: hidden;
    }

    /* Barra de Busca */
    .search-input-group .input-group-text {
        background-color: #F8F9FA;
        border: 1px solid #eee;
        border-right: none;
        color: #999;
    }
    .search-input-group input {
        background-color: #F8F9FA;
        border: 1px solid #eee;
        border-left: none;
        font-size: 14px;
        padding: 10px;
    }
    .search-input-group input:focus {
        background-color: #fff;
        border-color: #6200EA;
        box-shadow: none;
    }

    /* Tabela */
    .table-custom {
        width: 100%;
        margin-bottom: 0;
    }
    .table-custom th {
        font-size: 11px;
        font-weight: 700;
        color: #9AA0AC;
        text-transform: uppercase;
        border-bottom: 1px solid #f0f0f0;
        padding: 15px 24px;
        background-color: white;
    }
    .table-custom td {
        font-size: 14px;
        color: #444;
        vertical-align: middle;
        padding: 15px 24px;
        border-bottom: 1px solid #f9f9f9;
    }

    /* Badges e Botões */
    .badge-categoria {
        background-color: #F3E5F5;
        color: #8E24AA;
        padding: 5px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
    }

    .btn-purple {
        background-color: #6200EA;
        color: white;
        border-radius: 6px;
        padding: 8px 16px;
        font-weight: 500;
        border: none;
        transition: 0.2s;
    }
    .btn-purple:hover { background-color: #5000ca; color: white; }

    .action-btn { padding: 5px; transition: 0.2s; border: none; background: transparent; }
    .action-btn:hover { transform: scale(1.1); }
    .text-edit { color: #00bfa5; }
    .text-delete { color: #ff5252; }
</style>

<div class="row mb-4">
    <div class="col-md-4 mb-3 mb-md-0">
        <div class="card-stat">
            <div class="stat-label">Total de Livros (Títulos)</div>
            <div class="stat-value">{{ total_livros }}</div>
        </div>
    </div>
    <div class="col-md-4 mb-3 mb-md-0">
        <div class="card-stat">
            <div class="stat-label">Exemplares no Acervo</div>
            <div class="stat-value">{{ total_exemplares }}</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card-stat">
            <div class="stat-label">Categorias Cadastradas</div>
            <div class="stat-value">{{ total_categorias }}</div>
        </div>
    </div>
</div>

<div class="main-card">

    <div class="p-4 d-flex flex-wrap align-items-center justify-content-between gap-3 border-bottom border-light">
        <h5 class="mb-0 fw-bold text-secondary">Acervo de Livros</h5>

        <div class="d-flex gap-2 flex-grow-1 justify-content-end">
            <form method="get" class="d-flex w-100" style="max-width: 350px;">
                <div class="input-group search-input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" name="q" class="form-control" placeholder="Buscar por título, autor ou ISBN" value="{{ request.GET.q|default:'' }}" aria-label="Buscar">
                    <button class="btn btn-outline-light text-secondary border-start-0 border-top border-bottom border-end" style="border-color: #eee;" type="submit">Ir</button>
                </div>
            </form>

            <a href="{% url 'cadastro_livro' %}" class="btn-purple d-flex align-items-center gap-2 text-decoration-none">
                <i class="bi bi-plus-lg"></i> <span class="d-none d-md-inline">Adicionar Livro</span>
            </a>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table-custom">
            <thead>
                <tr>
                    <th>Título</th>
                    <th>Autor</th>
                    <th>Categoria</th>
                    <th>ISBN</th>
                    <th>Ano</th>
                    <th>Qtd</th>
                    <th class="text-end">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for livro in livros %}
                <tr>
                    <td>
                        <span class="fw-bold text-dark">{{ livro.titulo }}</span>
                    </td>
                    <td class="text-secondary">{{ livro.autor.nome }}</td>
                    <td>
                        <span class="badge-categoria">{{ livro.categoria.nome }}</span>
                    </td>
                    <td class="text-muted small">{{ livro.isbn }}</td>
                    <td class="text-muted small">{{ livro.ano_publicacao }}</td>
                    <td>
                        {% if livro.quantidade > 0 %}
                            <span class="fw-bold text-dark">{{ livro.quantidade }}</span>
                        {% else %}
                            <span class="badge bg-danger">0</span>
                        {% endif %}
                    </td>
                    <td class="text-end">
                        <a href="{% url 'editar_livro' livro.id %}" class="action-btn text-edit me-1" title="Editar">
                            <i class="bi bi-pencil-square fs-5"></i>
                        </a>
                        <button type="button" class="action-btn text-delete" data-bs-toggle="modal" data-bs-target="#modal{{ livro.id }}" title="Excluir">
                            <i class="bi bi-trash fs-5"></i>
                        </button>

                        <div class="modal fade" id="modal{{ livro.id }}" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content border-0 shadow-lg" style="border-radius: 16px;">
                                    <div class="modal-body text-center p-5">
                                        <div class="mb-3 mx-auto d-flex align-items-center justify-content-center rounded-circle bg-danger bg-opacity-10" style="width: 60px; height: 60px;">
                                            <i class="bi bi-trash3-fill text-danger fs-3"></i>
                                        </div>
                                        <h5 class="fw-bold mb-2">Excluir Livro?</h5>
                                        <p class="text-muted mb-4 text-start text-center">Tem certeza que deseja remover <strong>"{{ livro.titulo }}"</strong>?</p>
                                        <div class="d-flex justify-content-center gap-2">
                                            <button type="button" class="btn btn-light px-4" data-bs-dismiss="modal">Cancelar</button>
                                            <a href="{% url 'remover_livro' livro.id %}" class="btn btn-danger px-4">Sim, excluir</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center py-5">

                        {% if request.GET.q %}
                            <div class="text-muted">
                                <i class="bi bi-search" style="font-size: 2rem; color: #dee2e6;"></i>
                                <h6 class="mt-3 fw-bold text-secondary">Nenhum resultado encontrado</h6>
                                <p class="mb-3 small">
                                    Não encontramos livros, autores ou ISBN contendo "<strong>{{ request.GET.q }}</strong>".
                                </p>
                                <a href="{% url 'listagem_livros' %}" class="btn btn-sm btn-outline-secondary" style="border-radius: 6px;">
                                    <i class="bi bi-x-lg me-1"></i> Limpar Pesquisa
                                </a>
                            </div>

                        {% else %}
                            <div class="text-muted opacity-50">
                                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                                <p class="mb-0">Nenhum livro cadastrado.</p>
                            </div>
                        {% endif %}

                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}